<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= t('reports.customer_price_lists.report.header') %></title>
</head>
<body>
<table class="margin-bottom">

  <tr>
    <td>
      <img src="data:image/jpg;base64,<%= Base64.encode64(File.read(Rails.root.join('app',
                                                                                    'assets',
                                                                                    'images',
                                                                                    'facelift',
                                                                                    'logo.png'))) %>"/>
    </td>
    <td>
      <h1><%= t('reports.customer_price_list.header') %></h1>
    </td>
  </tr>

  <tr>
    <td colspan="2">
      <% if params[:date_start].present? && params[:date_end].present? %>
        <%= t('reports.customer_price_list.valid_text') %> <%= l Date.parse(params[:date_start]) %>
        - <%= l Date.parse(params[:date_end]) %>
      <% else %>
        <%= t('reports.customer_price_list.valid_text') %> <%= t('reports.customer_price_list.indefinitely').downcase %>
      <% end %>

    </td>
  </tr>

  <tr>
    <td colspan="2">
      <% if params[:date_start].present? && params[:date_end].present? %>
        <%= t('reports.customer_price_list.valid_text') %> <%= l Date.parse(params[:date_start]) %>
        - <%= l Date.parse(params[:date_end]) %>
      <% else %>
        <%= t('reports.customer_price_list.valid_text') %> <%= t('reports.customer_price_list.indefinitely').downcase %>
      <% end %>

    </td>
  </tr>

  <tr>
    <td>
      <ul class="list-unstyled">
        <li><%= current_company.nimi %></li>
        <li><%= current_company.ytunnus %></li>
        <li><%= current_company.osoite %></li>
        <li><%= current_company.postino %> <%= current_company.postitp %></li>
      </ul>
    </td>
    <td>
      <table>
        <tr>
          <% if @customer %>
            <td>
              <ul class="list-unstyled">
                <li><%= t('activerecord.models.customer') %></li>
                <li><%= @customer.nimi %></li>
                <li><%= @customer.osoite %></li>
                <li><%= @customer.postino %> <%= @customer.postitp %></li>
              </ul>
            </td>
          <% end %>

          <% if @customer %>
            <td>
              <ul class="list-unstyled">
                <li><%= t('activerecord.attributes.customer.asiakasnumero') %></li>
                <li><%= @customer.asiakasnro %></li>
                <li>
                  <table class="no-border">
                    <tr>
                      <td><%= t('activerecord.models.customer_category') %></td>
                      <td><%= t('activerecord.models.customer_subcategory') %></td>
                    </tr>
                    <tr>
                      <td><%= @customer.osasto %></td>
                      <td><%= @customer.ryhma %></td>
                    </tr>
                  </table>
                </li>
              </ul>
            </td>
          <% else %>
            <td colspan="2">
              <ul class="list-unstyled">
                <li>
                  <table class="no-border">
                    <tr>
                      <td><%= t('activerecord.models.customer_subcategory') %></td>
                    </tr>
                    <tr>
                      <td><%= @customer_subcategory %></td>
                    </tr>
                  </table>
                </li>
              </ul>
            </td>
          <% end %>
        </tr>
        <tr>
          <td>
            <ul class="list-unstyled">
              <li><%= t('activerecord.attributes.user.myyja') %></li>
              <li><%= current_user.nimi %></li>
            </ul>
          </td>
          <td>
            <ul class="list-unstyled">
              <li><%= t('reports.customer_price_list.printed') %></li>
              <li><%= l Time.now %></li>
            </ul>
          </td>
        </tr>
        <tr>

          <% if @customer %>
            <td colspan="2">
              <ul class="list-unstyled">
                <li><%= t('activerecord.attributes.customer.toimitustapa') %></li>
                <li><%= @customer.toimitustapa %></li>
              </ul>
            </td>
          <% end %>

        </tr>
        <tr>
          <% if @customer %>
            <td colspan="2">

              <ul class="list-unstyled">
                <li><%= t('activerecord.models.terms_of_payment') %></li>
                <li><%= @customer.terms_of_payment.teksti %></li>
              </ul>
            </td>
          <% end %>
        </tr>
      </table>
    </td>
  </tr>

  <% if Keyword::CustomerPriceListAttribute.message.present? %>
    <tr>
      <td colspan="2">
        <%= Keyword::CustomerPriceListAttribute.message %>
      </td>
    </tr>
  <% end %>

</table>

<table>
  <thead>

  <tr>
    <th><%= t('activerecord.attributes.product.tuoteno') %></th>
    <th><%= t('activerecord.attributes.product.nimitys') %></th>
    <th><%= t('reports.customer_price_list.price') %></th>
  </tr>

  </thead>
  <tbody>
  <% @products.each do |p| %>

    <tr>
      <td><strong><%= p.tuoteno %></strong></td>
      <td><strong><%= p.nimitys %></strong></td>
      <td>
        <% if @customer %>
          <%= number_to_currency(p.customer_price(@customer.id)) %>

          <% if @customer && @customer.contract_price?(p) %>
            (<%= t('reports.customer_price_list.sopimushinta') %>)
          <% end %>
        <% else %>
          <%= number_to_currency(p.customer_subcategory_price(@customer_subcategory)) %>
        <% end %>
      </td>
    </tr>

    <% if params[:lyhytkuvaus] && p.lyhytkuvaus.present? %>
      <tr>
        <td colspan="5"><%= p.lyhytkuvaus %></td>
      </tr>
    <% end %>

    <% if p.attachments.any? || p.kuvaus.present? %>
      <tr>
        <% if p.attachments.first && p.attachments.first.data %>
          <td>
            <img src="data:image/jpg;base64,<%= Base64.encode64(p.attachments.first.data) %>"
                 style="width: 100%;"/>
          </td>
        <% end %>

        <% if params[:kuvaus] && p.kuvaus.present? %>
          <td colspan="4"><%= p.kuvaus %></td>
        <% end %>
      </tr>
    <% end %>
  <% end %>

  </tbody>
</table>

</body>
</html>
